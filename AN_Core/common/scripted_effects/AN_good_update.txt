# Heavily inspired by Stockmarket mod
AN_price_update = {
	REB = {
		AN_effect_for_all = {
			scripted_effect = "AN_init_REB_var"
		}
	}
	every_country = {
		limit = {
			NOT = {	tag = REB }
		}

		AN_gain_merchant_capacity_monthly_for_country = yes 

		set_country_flag = transaction_lock #use this to lock buying and selling if a month tick happens
		#while the event is open

		AN_effect_for_all = {
			scripted_effect = "AN_init_price_update"
		}
		
		export_to_variable = {
			variable_name = temp_global_trade_goods_size_modifier
			value = modifier:global_trade_goods_size_modifier
			who = ROOT
		}
		export_to_variable = {
			variable_name = temp_global_trade_goods_size
			value = modifier:global_trade_goods_size
			who = ROOT
		}

		every_owned_province = {
			owner = {
				#export_to_variable = {
				#	which = tempvardev
				#	value = trigger_value:development
				#	who = PREV
				#}
				change_variable = {
					which = AN_prov_pop
					which = PREV
				}
			}
			AN_demand_craze_all = yes
			#update_supply_and_demand_based_on_buildings = yes #Amyz temp disabled
			AN_update_supply_all = yes
			AN_effect_for_all = {
				scripted_effect = "AN_update_demand_all"
			}
		}
		AN_effect_for_all = {
			scripted_effect = "AN_update_national_supply"
		}
		AN_effect_for_all = {
			scripted_effect = "AN_update_national_demand"
		}
		
		AN_effect_for_all = {
			scripted_effect = "AN_apply_policies"
		}
		
		AN_effect_for_all = {
			scripted_effect = "AN_post_eval"
		}
		
		REB = {
			AN_effect_for_all = {
				scripted_effect = "AN_change_REB_var"
			}
		}
	}
	
	REB = {
		AN_effect_for_all = {
			scripted_effect = "AN_save_old_prices"
		}
	}

	AN_effect_for_all = {
		scripted_effect = "AN_set_price"
	}

	REB = {
		AN_effect_for_all = {
			scripted_effect = "AN_get_price_growth"
		}
	}

	#BUY / SELL needed goods
	every_country = {
		limit = {
			NOT = {	tag = REB }
		}		
		AN_effect_for_all = {
			scripted_effect = "AN_check_good_satisfaction"
		}

	}
}
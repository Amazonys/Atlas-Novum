# CLIMATE
AN_check_climate = {
	hidden_effect = {
		set_variable = { which = AN_prov_climate value = 0 }
		if = {
			limit = { has_global_flag = AN_global_climate_A }
			trigger_switch = {
				on_trigger = has_province_modifier
				climate_sicco = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_xeric = { set_variable = { which = AN_prov_pop_cap value = 3 } } 
				climate_veldt = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_montane = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_polar = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				#
				climate_outback = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_levante = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_chaco = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_pratumic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_boreal = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				#
				climate_chaparral = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_mediterranean = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_temperate = { set_variable = { which = AN_prov_pop_cap value = 9 } }
				climate_continental = { set_variable = { which = AN_prov_pop_cap value = 8 } }
				climate_hemiboreal = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				#
				climate_cerradic = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_calidic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_mesothermal = { set_variable = { which = AN_prov_pop_cap value = 8 } }
				climate_nemoral = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_oceanic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				#
				climate_tropical = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_pantanal = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_subtropical = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_cascadic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_maritime = { set_variable = { which = AN_prov_pop_cap value = 5 } }
			}
		}
		else_if = {
			limit = { has_global_flag = AN_global_climate_0 }
			trigger_switch = {
				on_trigger = has_province_modifier
				climate_sicco = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_xeric = { set_variable = { which = AN_prov_pop_cap value = 4 } } 
				climate_veldt = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_montane = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_polar = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				#
				climate_outback = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_levante = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_chaco = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_pratumic = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_boreal = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				#
				climate_chaparral = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_mediterranean = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_temperate = { set_variable = { which = AN_prov_pop_cap value = 8 } }
				climate_continental = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_hemiboreal = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				#
				climate_cerradic = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_calidic = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_mesothermal = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_nemoral = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_oceanic = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				#
				climate_tropical = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_pantanal = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_subtropical = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_cascadic = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_maritime = { set_variable = { which = AN_prov_pop_cap value = 3 } }
			}
		}
		else_if = {
			limit = { has_global_flag = AN_global_climate_1 }
			trigger_switch = {
				on_trigger = has_province_modifier
				climate_sicco = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_xeric = { set_variable = { which = AN_prov_pop_cap value = 5 } } 
				climate_veldt = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_montane = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_polar = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				#
				climate_outback = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_levante = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_chaco = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_pratumic = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_boreal = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				#
				climate_chaparral = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_mediterranean = { set_variable = { which = AN_prov_pop_cap value = 8 } }
				climate_temperate = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_continental = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_hemiboreal = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				#
				climate_cerradic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_calidic = { set_variable = { which = AN_prov_pop_cap value = 9 } }
				climate_mesothermal = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_nemoral = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_oceanic = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				#
				climate_tropical = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_pantanal = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_subtropical = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_cascadic = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_maritime = { set_variable = { which = AN_prov_pop_cap value = 2 } }
			}
		}
		else_if = {
			limit = { has_global_flag = AN_global_climate_2 }
			trigger_switch = {
				on_trigger = has_province_modifier
				climate_sicco = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_xeric = { set_variable = { which = AN_prov_pop_cap value = 4 } } 
				climate_veldt = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_montane = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_polar = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_outback = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_levante = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_chaco = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_pratumic = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_boreal = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_chaparral = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_mediterranean = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_temperate = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_continental = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_hemiboreal = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				#
				climate_cerradic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_calidic = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_mesothermal = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_nemoral = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_oceanic = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				#
				climate_tropical = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_pantanal = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_subtropical = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_cascadic = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_maritime = { set_variable = { which = AN_prov_pop_cap value = 1 } }
			}
		}
		else_if = {
			limit = { has_global_flag = AN_global_climate_3 }
			trigger_switch = {
				on_trigger = has_province_modifier
				climate_sicco = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_xeric = { set_variable = { which = AN_prov_pop_cap value = 3 } } 
				climate_veldt = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_montane = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				climate_polar = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_outback = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_levante = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_chaco = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_pratumic = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				climate_boreal = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_chaparral = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_mediterranean = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_temperate = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_continental = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_hemiboreal = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_cerradic = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_calidic = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_mesothermal = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_nemoral = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_oceanic = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_tropical = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_pantanal = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_subtropical = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_cascadic = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_maritime = { set_variable = { which = AN_prov_pop_cap value = 0 } }
			}
		}
		else_if = {
			limit = { has_global_flag = AN_global_climate_4 }
			trigger_switch = {
				on_trigger = has_province_modifier
				climate_sicco = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_xeric = { set_variable = { which = AN_prov_pop_cap value = 2 } } 
				climate_veldt = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_montane = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				climate_polar = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_outback = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_levante = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_chaco = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_pratumic = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				climate_boreal = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_chaparral = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_mediterranean = { set_variable = { which = AN_prov_pop_cap value = 4 } }
				climate_temperate = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_continental = { set_variable = { which = AN_prov_pop_cap value = 1 } }
				climate_hemiboreal = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_cerradic = { set_variable = { which = AN_prov_pop_cap value = 7 } }
				climate_calidic = { set_variable = { which = AN_prov_pop_cap value = 5 } }
				climate_mesothermal = { set_variable = { which = AN_prov_pop_cap value = 3 } }
				climate_nemoral = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				climate_oceanic = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				#
				climate_tropical = { set_variable = { which = AN_prov_pop_cap value = 8 } }
				climate_pantanal = { set_variable = { which = AN_prov_pop_cap value = 6 } }
				climate_subtropical = { set_variable = { which = AN_prov_pop_cap value = 2 } }
				climate_cascadic = { set_variable = { which = AN_prov_pop_cap value = 0 } }
				climate_maritime = { set_variable = { which = AN_prov_pop_cap value = 0 } }
			}
		}
		#for dynamic localization purposes
		change_variable = {
			which = AN_prov_climate
			which = AN_prov_pop_cap
		}
	}
}

# DEVELOPMENT
AN_check_dev_variables = {
	hidden_effect = {
		set_variable = { which = AN_wealth_production value = 0 }
		set_variable = { which = AN_wealth_growth value = 1 }
		#set_variable = { which = AN_pop_production value = 0 }
		#set_variable = { which = AN_pop_growth value = 1 }

		set_variable = { which = AN_logistics value = 0 }
		set_variable = { which = AN_consumption value = 0 }
		set_variable = { which = AN_prov_pop value = 0 }
		set_variable = { which = AN_prov_infrastructure value = 0 }
		set_variable = { which = AN_prov_infrastructure_cap value = 0 }
		set_variable = { which = AN_prov_wealth value = 0 }
		set_variable = { which = AN_migration_factor value = 0 }
		set_variable = { which = AN_migration_growth value = 1 }
		set_variable = { which = AN_civ_stat value = 0 }
		

		#EXPORT DEV FOR CHECKS
		export_to_variable = {
			variable_name = AN_logistics
			value = modifier:local_development_cost
		}
		if = { #-99.9% is the max negative consumption cost
			limit = {
				NOT = { check_variable = { which = AN_logistics value = 0.001 } }
			}
			set_variable = { which = AN_logistics value = 0.001 }
		}
		#export_to_variable = {
		#	variable_name = AN_autonomy
		#	value = trigger_value:local_autonomy
		#}
		#multiply_variable = { which = AN_autonomy value = -1 }
		#change_variable = { which = AN_autonomy value = 100 }
		#divide_variable = { which = AN_autonomy value = 100 }
		#export_to_variable = {
		#	variable_name = AN_conv_cost
		#	value = modifier:local_culture_conversion_cost
		#}
		#if = { 
		#	limit = { NOT = { check_variable = { which = AN_conv_cost value = 0 } } }
		#	multiply_variable = { which = AN_conv_cost value = -1 }
		#}
		#change_variable = { which = AN_conv_cost value = 1 }
		export_to_variable = {
			variable_name = AN_prov_infrastructure
			value = trigger_value:base_production
		}
		export_to_variable = {
			variable_name = AN_prov_pop
			value = trigger_value:base_manpower
		}
		export_to_variable = {
			variable_name = AN_prov_wealth
			value = trigger_value:base_tax
		}
		###
		export_to_variable = {
			variable_name = AN_province_culture
			value = culture
		}
		export_to_variable = {
			variable_name = AN_province_religion
			value = religion
		}
		
		### CIV 
		set_variable = { which = AN_civ_stat which = AN_prov_infrastructure }
		
		if = {
			limit = { is_capital = yes}
			change_variable = { which = AN_civ_stat value = 3 } 
		}
		
		trigger_switch = {
			on_trigger = has_building
			fort_15th = { change_variable = { which = AN_civ_stat value = 1 } }
			fort_16th = { change_variable = { which = AN_civ_stat value = 2 } }
			fort_17th = { change_variable = { which = AN_civ_stat value = 3 } }
			fort_18th = { change_variable = { which = AN_civ_stat value = 4 } }
		}
		
		trigger_switch = {
			on_trigger = has_building
			shrine = { change_variable = { which = AN_civ_stat value = 1 } }
			monastery = { change_variable = { which = AN_civ_stat value = 2 } }
			temple = { change_variable = { which = AN_civ_stat value = 3 } }
			cathedral = { change_variable = { which = AN_civ_stat value = 4 } }
		}
		
		trigger_switch = {
			on_trigger = has_building
			marketplace = { change_variable = { which = AN_civ_stat value = 1 } }
			trade_depot = { change_variable = { which = AN_civ_stat value = 2 } }
			counting_house = { change_variable = { which = AN_civ_stat value = 3 } }
			bank = { change_variable = { which = AN_civ_stat value = 4 } }
		}
		
		trigger_switch = {
			on_trigger = has_building
			jetty = { change_variable = { which = AN_civ_stat value = 1 } }
			wharf = { change_variable = { which = AN_civ_stat value = 2 } }
			dock = { change_variable = { which = AN_civ_stat value = 3 } }
			impressment_offices = { change_variable = { which = AN_civ_stat value = 4 } }
		}
		
		trigger_switch = {
			on_trigger = has_building
			school = { change_variable = { which = AN_civ_stat value = 2 } }
			college = { change_variable = { which = AN_civ_stat value = 4 } }
			university = { change_variable = { which = AN_civ_stat value = 6 } }
			academy = { change_variable = { which = AN_civ_stat value = 8 } }
		}
		
		trigger_switch = {
			on_trigger = has_building
			cottage = { change_variable = { which = AN_civ_stat value = 2 } }
			workshop = { change_variable = { which = AN_civ_stat value = 4 } }
			new_manufactory = { change_variable = { which = AN_civ_stat value = 6 } }
			factory = { change_variable = { which = AN_civ_stat value = 8 } }
		}
		
		trigger_switch = {
			on_trigger = has_building
			studio = { change_variable = { which = AN_civ_stat value = 2 } }
			artisanate = { change_variable = { which = AN_civ_stat value = 4 } }
			theatre = { change_variable = { which = AN_civ_stat value = 6 } }
			museum = { change_variable = { which = AN_civ_stat value = 8 } }
		}
		
		trigger_switch = {
			on_trigger = has_building
			training_fields = { change_variable = { which = AN_civ_stat value = 2 } }
			infirmary = { change_variable = { which = AN_civ_stat value = 4 } }
			hospital = { change_variable = { which = AN_civ_stat value = 6 } }
			public_sanitation = { change_variable = { which = AN_civ_stat value = 8 } }
		}
		
		trigger_switch = {
			on_trigger = has_building
			constabulary = { change_variable = { which = AN_civ_stat value = 2 } }
			courthouse = { change_variable = { which = AN_civ_stat value = 4 } }
			town_hall = { change_variable = { which = AN_civ_stat value = 6 } }
			state_house = { change_variable = { which = AN_civ_stat value = 8 } }
		}
		
		trigger_switch = {
			on_trigger = has_building
			customs_house = { change_variable = { which = AN_civ_stat value = 4 } }
			library = { change_variable = { which = AN_civ_stat value = 10 } }
			prison = { change_variable = { which = AN_civ_stat value = 2 } }
		}
		
		trigger_switch = {
			on_trigger = has_building
			postmaster_general = { change_variable = { which = AN_civ_stat value = 5 } }
			national_court = { change_variable = { which = AN_civ_stat value = 5 } }
			national_mint = { change_variable = { which = AN_civ_stat value = 5 } }
			foreign_office = { change_variable = { which = AN_civ_stat value = 3 } }
			war_college = { change_variable = { which = AN_civ_stat value = 3 } }
			admiralty = { change_variable = { which = AN_civ_stat value = 3 } }
			stock_exchange = { change_variable = { which = AN_civ_stat value = 5 } }
		}
		
		#Institutions
		if = {
			limit = { owner = { has_institution = writing } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = bureaucracy } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = feudalism } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = scholasticism } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = commercialism } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = finance } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = renaissance } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = printing_press } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = new_world_i } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = empiricism } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = global_trade } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = state_sovereignty } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = enlightenment } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = manufactories } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = nationalism_i } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}
		if = {
			limit = { owner = { has_institution = industrialization } }
			change_variable = { which = AN_civ_stat value = 2 } 
		}

		
		if = { 
			limit = { base_manpower = 5 } 
			multiply_variable = { which = AN_civ_stat which = AN_prov_wealth }
			divide_variable = { which = AN_civ_stat which = AN_prov_pop }
		}
		
		###
		AN_check_climate = yes
		###
		
		change_variable = {
			which = AN_wealth_production
			which = AN_prov_infrastructure
		}
		multiply_variable = {
			which = AN_wealth_production
			value = 0.5
		}
		#change_variable = {
		#	which = AN_pop_production
		#	which = AN_prov_infrastructure
		#}
		#multiply_variable = {
		#	which = AN_pop_production
		#	value = 0.5
		#}
		
		#############
		# TRIGGER SWITCH FOR Terrain contribution to Carrying Capacity & Growth
		trigger_switch = {
			on_trigger = has_terrain
			farmlands = { 
			#	change_variable = { which = AN_wealth_production value = 12 } 
			#	change_variable = { which = AN_pop_production value = 12 } 
				change_variable = { which = AN_prov_pop_cap value = 8 }
				change_variable = { which = AN_prov_infrastructure_cap value = 8 }
			}
			grasslands = { 
			#	change_variable = { which = AN_wealth_production value = 10 } 
			#	change_variable = { which = AN_pop_production value = 10 } 
				change_variable = { which = AN_prov_pop_cap value = 6 }
				change_variable = { which = AN_prov_infrastructure_cap value = 6 }
			}
			drylands = { 
			#	change_variable = { which = AN_wealth_production value = 9 } 
			#	change_variable = { which = AN_pop_production value = 9 } 
				change_variable = { which = AN_prov_pop_cap value = 6 }
				change_variable = { which = AN_prov_infrastructure_cap value = 6 }
			}
			#
			woods = { 
			#	change_variable = { which = AN_wealth_production value = 8 } 
			#	change_variable = { which = AN_pop_production value = 8 } 
				change_variable = { which = AN_prov_pop_cap value = 5 }
				change_variable = { which = AN_prov_infrastructure_cap value = 5 }
			}
			marsh = { 
			#	change_variable = { which = AN_wealth_production value = 8 } 
			#	change_variable = { which = AN_pop_production value = 6 } 
				change_variable = { which = AN_prov_pop_cap value = 5 }
				change_variable = { which = AN_prov_infrastructure_cap value = 5 }
			}
			hills = { 
			#	change_variable = { which = AN_wealth_production value = 5 } 
			#	change_variable = { which = AN_pop_production value = 5 } 
				change_variable = { which = AN_prov_pop_cap value = 5 }
				change_variable = { which = AN_prov_infrastructure_cap value = 4 }
			}
			#
			jungle = { 
			#	change_variable = { which = AN_wealth_production value = 5 } 
			#	change_variable = { which = AN_pop_production value = 6 } 
				change_variable = { which = AN_prov_pop_cap value = 4 } 
				change_variable = { which = AN_prov_infrastructure_cap value = 4 }
			}
			coastline = { 
			#	change_variable = { which = AN_wealth_production value = 6 } 
			#	change_variable = { which = AN_pop_production value = 5 } 
				change_variable = { which = AN_prov_pop_cap value = 4 }
				change_variable = { which = AN_prov_infrastructure_cap value = 5 }
			}
			steppe = { 
			#	change_variable = { which = AN_wealth_production value = 4 } 
			#	change_variable = { which = AN_pop_production value = 5 } 
				change_variable = { which = AN_prov_pop_cap value = 4 }
				change_variable = { which = AN_prov_infrastructure_cap value = 4 }
			}
			#
			highlands = { 
			#	change_variable = { which = AN_wealth_production value = 3 } 
			#	change_variable = { which = AN_pop_production value = 4 } 
				change_variable = { which = AN_prov_pop_cap value = 4 }
				change_variable = { which = AN_prov_infrastructure_cap value = 3 }
			}
			savannah = { 
			#	change_variable = { which = AN_wealth_production value = 3 } 
			#	change_variable = { which = AN_pop_production value = 4 } 
				change_variable = { which = AN_prov_pop_cap value = 4 }
				change_variable = { which = AN_prov_infrastructure_cap value = 4 }
			}
			coastal_desert = { 
			#	change_variable = { which = AN_wealth_production value = 4 } 
			#	change_variable = { which = AN_pop_production value = 3 } 
				change_variable = { which = AN_prov_pop_cap value = 2 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			#
			forest = { 
			#	change_variable = { which = AN_wealth_production value = 3 } 
			#	change_variable = { which = AN_pop_production value = 3 } 
				change_variable = { which = AN_prov_pop_cap value = 3 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			mountain = { 
			#	change_variable = { which = AN_wealth_production value = 3 } 
			#	change_variable = { which = AN_pop_production value = 2 } 
				change_variable = { which = AN_prov_pop_cap value = 3 } 
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			badlands = { 
			#	change_variable = { which = AN_wealth_production value = 2 } 
			#	change_variable = { which = AN_pop_production value = 2 } 
				change_variable = { which = AN_prov_pop_cap value = 2 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			#
			tundra = { 
			#	change_variable = { which = AN_wealth_production value = 2 } 
			#	change_variable = { which = AN_pop_production value = 1 } 
				change_variable = { which = AN_prov_pop_cap value = 1 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			desert = { 
			#	change_variable = { which = AN_wealth_production value = 3 } 
			#	change_variable = { which = AN_pop_production value = 2 } 
				change_variable = { which = AN_prov_pop_cap value = 1 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			glacier = { 
			#	change_variable = { which = AN_wealth_production value = 1 } 
			#	change_variable = { which = AN_pop_production value = 1 } 
				change_variable = { which = AN_prov_pop_cap value = 1 }
				change_variable = { which = AN_prov_infrastructure_cap value = 1 }
			}
		}
		
		## terrain features
		trigger_switch = { # non-stackable features
			on_trigger = has_province_modifier
			atoll = {
			#	change_variable = { which = AN_pop_production value = 2 } 
				change_variable = { which = AN_prov_pop_cap value = 2 }
				subtract_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			barrier_islands = {
				change_variable = { which = AN_prov_pop_cap value = 2 }
				change_variable = { which = AN_prov_infrastructure_cap value = 1 }
			}
			cliff = {
				subtract_variable = { which = AN_prov_pop_cap value = 1 }
				subtract_variable = { which = AN_prov_infrastructure_cap value = 1 }
			}
			canyon = {
			#	change_variable = { which = AN_pop_production value = 1 } 
				change_variable = { which = AN_prov_pop_cap value = 1 }
				subtract_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			cove = {
				change_variable = { which = AN_prov_pop_cap value = 1 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			valley = {
			#	change_variable = { which = AN_pop_production value = 3 } 
				change_variable = { which = AN_prov_pop_cap value = 1 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			fjord = {
			#	change_variable = { which = AN_pop_production value = 1 } 
				change_variable = { which = AN_prov_pop_cap value = 2 }
				subtract_variable = { which = AN_prov_infrastructure_cap value = 1 }
			}
			plateau = {
				change_variable = { which = AN_prov_pop_cap value = 1 }
				subtract_variable = { which = AN_prov_infrastructure_cap value = 1 }
			}
			wadi = {
			#	change_variable = { which = AN_pop_production value = 1 } 
				change_variable = { which = AN_prov_pop_cap value = 2 }
			}
			oasis = {
			#	change_variable = { which = AN_pop_production value = 2 } 
				change_variable = { which = AN_prov_pop_cap value = 2 }
				change_variable = { which = AN_prov_infrastructure_cap value = 2 }
			}
			volcano = {
				change_variable = { which = AN_prov_pop_cap value = 3 }
				subtract_variable = { which = AN_prov_infrastructure_cap value = 1 }
			}
			confluence = {
			#	change_variable = { which = AN_pop_production value = 2 } 
				change_variable = { which = AN_prov_pop_cap value = 2 }
				change_variable = { which = AN_prov_infrastructure_cap value = 1 }
			}
		}
		# stackable features
		if = {
			limit = { has_province_modifier = marsh_feature }
		#	subtract_variable = { which = AN_pop_production value = 2 } 
			subtract_variable = { which = AN_prov_pop_cap value = 1 }
			subtract_variable = { which = AN_prov_infrastructure_cap value = 2 }
		}
		if = {
			limit = { has_province_modifier = swamp }
		#	subtract_variable = { which = AN_pop_production value = 2 } 
			subtract_variable = { which = AN_prov_pop_cap value = 2 }
			subtract_variable = { which = AN_prov_infrastructure_cap value = 2 }
		}
		if = {
			limit = { has_province_modifier = bog }
		#	subtract_variable = { which = AN_pop_production value = 2 } 
			subtract_variable = { which = AN_prov_pop_cap value = 1 }
			subtract_variable = { which = AN_prov_infrastructure_cap value = 3 }
		}
		if = {
			limit = { has_province_modifier = bayou }
			subtract_variable = { which = AN_prov_pop_cap value = 1 }
			change_variable = { which = AN_prov_infrastructure_cap value = 2 }
		}
		if = {
			limit = { has_province_modifier = floodplain }
		#	change_variable = { which = AN_pop_production value = 4 } 
			change_variable = { which = AN_prov_pop_cap value = 2 }
			subtract_variable = { which = AN_prov_infrastructure_cap value = 2 }
		}
		if = {
			limit = { has_province_modifier = lakeshore }
		#	change_variable = { which = AN_pop_production value = 1 } 
			change_variable = { which = AN_prov_pop_cap value = 1 }
			change_variable = { which = AN_prov_infrastructure_cap value = 1 }
		}
		

		## infr prj
		if = {
			limit = { has_province_modifier = irrigation }
		#	change_variable = { which = AN_pop_production value = 6 } 
			change_variable = { which = AN_prov_pop_cap value = 2 }
			change_variable = { which = AN_prov_infrastructure_cap value = 1 }
		}
		if = {
			limit = { has_province_modifier = gardens }
		#	change_variable = { which = AN_pop_production value = 2 } 
			change_variable = { which = AN_prov_pop_cap value = 3 }
			change_variable = { which = AN_prov_infrastructure_cap value = 1 }
		}
		if = {
			limit = { has_province_modifier = wells }
		#	change_variable = { which = AN_pop_production value = 4 } 
			change_variable = { which = AN_prov_pop_cap value = 4 }
			change_variable = { which = AN_prov_infrastructure_cap value = 1 }
		}
		if = {
			limit = { has_province_modifier = terrace }
		#	change_variable = { which = AN_pop_production value = 3 } 
			change_variable = { which = AN_prov_pop_cap value = 3 }
			change_variable = { which = AN_prov_infrastructure_cap value = 3 }
		}
		if = {
			limit = { has_province_modifier = dikes }
			change_variable = { which = AN_prov_pop_cap value = 5 }
			change_variable = { which = AN_prov_infrastructure_cap value = 5 }
		}
		if = {
			limit = { has_province_modifier = breakwaters } 
			change_variable = { which = AN_prov_pop_cap value = 1 }
			change_variable = { which = AN_prov_infrastructure_cap value = 2 }
		}
		if = {
			limit = { has_province_modifier = lighthouse }
			change_variable = { which = AN_prov_infrastructure_cap value = 2 }
		}
		if = {
			limit = { has_province_modifier = dam }
		#	change_variable = { which = AN_pop_production value = 2 } 
			change_variable = { which = AN_prov_pop_cap value = 4 }
			change_variable = { which = AN_prov_infrastructure_cap value = 4 }
		}
		
		##Migration		
		trigger_switch = { 
			on_trigger = has_building
			village = { 
				change_variable = { which = AN_prov_infrastructure_cap  value = 4 }
				change_variable = { which = AN_prov_pop_cap  value = 4 }
			}
			town = { 
				change_variable = { which = AN_prov_infrastructure_cap  value = 8 }
				change_variable = { which = AN_prov_pop_cap  value = 8 }
			}
			city = {
				change_variable = { which = AN_prov_infrastructure_cap  value = 12 }
				change_variable = { which = AN_prov_pop_cap  value = 12 }
			} 
			metropolis = { 
				change_variable = { which = AN_prov_infrastructure_cap  value = 16 }
				change_variable = { which = AN_prov_pop_cap  value = 16 }
			}
		}
		
		set_variable = { which = AN_pop_production which = AN_prov_pop }
		multiply_variable = { which = AN_pop_production which = AN_prov_pop }
		divide_variable = { which = AN_pop_production which = AN_prov_pop_cap }
		set_variable = { which = AN_pop_growth which = AN_prov_pop }
		subtract_variable = { which = AN_pop_growth which = AN_pop_production }
		subtract_variable = { which = AN_pop_growth value = 1 }
		multiply_variable = { which = AN_pop_growth value = 5 } #5 base growth - min/max 1 pop every 20 yrs
		
		
		
		change_variable = {
			which = AN_migration_factor
			which = AN_prov_pop_cap
		}
		subtract_variable = {
			which = AN_migration_factor
			which = AN_prov_pop
		}
		
		
		if = {
			limit = { NOT = { check_variable = { which = AN_migration_factor value = 0 } } }
			multiply_variable = {
				which = AN_migration_factor
				value = 2
			}
		}	
		else_if = {
			limit = { check_variable = { which = AN_migration_factor value = 0 } }
			multiply_variable = {
				which = AN_migration_factor
				value = 0.5
			}
		}
		
		
		#Migration		
		trigger_switch = { 
			on_trigger = has_building
			village = { 
				change_variable = { which = AN_migration_factor value = 1 }
			}
			town = { 
				change_variable = { which = AN_migration_factor value = 2 }
			}
			city = {
				change_variable = { which = AN_migration_factor value = 3 }
			} 
			metropolis = { 
				change_variable = { which = AN_migration_factor value = 4 }
			}
		}
		if = {
			limit = { NOT = { OR = { has_building = village has_building = town has_building = city has_building = metropolis } } }
			subtract_variable = { which = AN_migration_factor value = 5 }
		}
		if = {
			limit = { is_capital = yes }
			change_variable = { which = AN_migration_factor value = 3 }
		}
		if = {
			limit = { is_looted = yes }
			subtract_variable = { which = AN_migration_factor value = 2 }
		}
		if = { 
			limit = { has_siege = yes }
			change_variable = { which = AN_migration_factor value = 30 }
		}
		if = {
			limit = { NOT = { controlled_by = owner } }
			change_variable = { which = AN_migration_factor value = 10 }
		}
		divide_variable = {
			which = AN_civ_stat
			value = 10
		}
		change_variable = {
			which = AN_migration_factor
			which = AN_civ_stat
		}
		
		#Trade Goods
		trigger_switch = {
			on_trigger = trade_goods
			birds = { multiply_variable = { which = AN_wealth_growth value = 0.6  } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			bison = { multiply_variable = { which = AN_wealth_growth value = 0.6  } multiply_variable = { which = AN_pop_growth value = 1.1 } }
			camels = { multiply_variable = { which = AN_wealth_growth value = 1.1  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			copper = { multiply_variable = { which = AN_wealth_growth value = 1.3  } }
			crustaceans = { multiply_variable = { which = AN_wealth_growth value = 0.9  } multiply_variable = { which = AN_pop_growth value = 1.3 } }
			dates = { multiply_variable = { which = AN_wealth_growth value = 1.1  } multiply_variable = { which = AN_pop_growth value = 1.1 } }
			fish = { multiply_variable = { which = AN_wealth_growth value = 1.1  } multiply_variable = { which = AN_pop_growth value = 1.2 } }
			fruit = { multiply_variable = { which = AN_wealth_growth value = 1.1  } multiply_variable = { which = AN_pop_growth value = 1.1 } }
			fur = { multiply_variable = { which = AN_wealth_growth value = 0.7  } multiply_variable = { which = AN_pop_growth value = 0.7 } }
			gold = { multiply_variable = { which = AN_wealth_growth value = 1.5  } }
			grain = { multiply_variable = { which = AN_pop_growth value = 1.5 } }
			hardwood = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			herbs = { multiply_variable = { which = AN_wealth_growth value = 1.1  } multiply_variable = { which = AN_pop_growth value = 1.1 } }
			horses = { multiply_variable = { which = AN_pop_growth value = 0.9 } }
			incense = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.7 } }
			ivory = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.5 } }
			#jade = { multiply_variable = { which = AN_wealth_growth value = 1.1  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			livestock = { multiply_variable = { which = AN_pop_growth value = 1.4 } }
			maize = { multiply_variable = { which = AN_wealth_growth value = 0.9  } multiply_variable = { which = AN_pop_growth value = 1.3 } }
			millet = { multiply_variable = { which = AN_wealth_growth value = 0.8  } multiply_variable = { which = AN_pop_growth value = 1.3 } }
			palm = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			pelagic_fish = { multiply_variable = { which = AN_wealth_growth value = 0.9  } multiply_variable = { which = AN_pop_growth value = 1.2 } }
			potatoes = { multiply_variable = { which = AN_wealth_growth value = 0.8  } multiply_variable = { which = AN_pop_growth value = 1.4 } }
			pottery = { multiply_variable = { which = AN_wealth_growth value = 1.1  } }
			poultry = { multiply_variable = { which = AN_wealth_growth value = 0.9  } multiply_variable = { which = AN_pop_growth value = 1.4 } }
			rice = { multiply_variable = { which = AN_pop_growth value = 1.4 } }
			salt = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			shoal_fish = { multiply_variable = { which = AN_wealth_growth value = 0.9  } multiply_variable = { which = AN_pop_growth value = 1.1 } }
			silver = { multiply_variable = { which = AN_wealth_growth value = 1.5  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			softwood = { multiply_variable = { which = AN_wealth_growth value = 1.1  } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			stone = { multiply_variable = { which = AN_wealth_growth value = 0.8  } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			#tomatoes = { multiply_variable = { which = AN_pop_growth value = 1.1 } }
			tin = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			tropical_wood = { multiply_variable = { which = AN_wealth_growth value = 1.3  } multiply_variable = { which = AN_pop_growth value = 0.7 } }
			whales = { multiply_variable = { which = AN_wealth_growth value = 1.2  }  }
			wool = { multiply_variable = { which = AN_wealth_growth value = 0.9  }  }
			#
			apiculture = { multiply_variable = { which = AN_wealth_growth value = 1.1 } }
			alum = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			cloves = { multiply_variable = { which = AN_wealth_growth value = 1.5  } multiply_variable = { which = AN_pop_growth value = 0.5 } }
			black_pepper = { multiply_variable = { which = AN_wealth_growth value = 1.4  } multiply_variable = { which = AN_pop_growth value = 0.7 } }
			cocoa = { multiply_variable = { which = AN_wealth_growth value = 1.3  } multiply_variable = { which = AN_pop_growth value = 0.7 } }
			#carpet = { multiply_variable = { which = AN_wealth_growth value = 1.2  } }
			cassava = { multiply_variable = { which = AN_wealth_growth value = 0.9  } multiply_variable = { which = AN_pop_growth value = 1.1 } }
			cinnamon = { multiply_variable = { which = AN_wealth_growth value = 1.3  } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			coffee = { multiply_variable = { which = AN_wealth_growth value = 1.4  } multiply_variable = { which = AN_pop_growth value = 0.6 } }
			cotton = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			dairy = { multiply_variable = { which = AN_wealth_growth value = 1.1  } multiply_variable = { which = AN_pop_growth value = 1.1 } }
			dyes = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			gems = { multiply_variable = { which = AN_wealth_growth value = 1.4  } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			hemp = { multiply_variable = { which = AN_wealth_growth value = 1.1 } }
			iron = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			lead = { multiply_variable = { which = AN_pop_growth value = 0.8 } }
			leather = { multiply_variable = { which = AN_wealth_growth value = 1.1  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			marble = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			mollusk = { multiply_variable = { which = AN_wealth_growth value = 1.1 } }
			mercury = { multiply_variable = { which = AN_wealth_growth value = 1.1 } multiply_variable = { which = AN_pop_growth value = 0.7 } }
			#nutmeg = { multiply_variable = { which = AN_wealth_growth value = 1.4  } multiply_variable = { which = AN_pop_growth value = 0.6 } }
			chili_peppers = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			nuts = { multiply_variable = { which = AN_wealth_growth value = 1.1  } multiply_variable = { which = AN_pop_growth value = 1.1 } }
			spices = { multiply_variable = { which = AN_wealth_growth value = 1.5  } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			olives = { multiply_variable = { which = AN_pop_growth value = 1.1 } }
			opium = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			paper = { multiply_variable = { which = AN_wealth_growth value = 1.1  } }
			niter = { multiply_variable = { which = AN_pop_growth value = 0.9 } }
			slaves = { multiply_variable = { which = AN_wealth_growth value = 1.1  } multiply_variable = { which = AN_pop_growth value = 0.5 } }
			saffron = { multiply_variable = { which = AN_wealth_growth value = 1.2  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			silk = { multiply_variable = { which = AN_wealth_growth value = 1.3  } }
			legumes = { multiply_variable = { which = AN_pop_growth value = 1.2 } }
			sugar = { multiply_variable = { which = AN_wealth_growth value = 1.3  } multiply_variable = { which = AN_pop_growth value = 0.7 } }
			sulfur = { multiply_variable = { which = AN_wealth_growth value = 0.9  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			tea = { multiply_variable = { which = AN_wealth_growth value = 1.3  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			tobacco = { multiply_variable = { which = AN_wealth_growth value = 1.3  } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			vanilla = { multiply_variable = { which = AN_wealth_growth value = 1.3  } multiply_variable = { which = AN_pop_growth value = 0.7 } }
			zinc = { multiply_variable = { which = AN_wealth_growth value = 1.1  } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			#
			#artistry = { multiply_variable = { which = AN_wealth_growth value = 1.5 } }
			artifices = { multiply_variable = { which = AN_wealth_growth value = 1.3 } }
			beer = { multiply_variable = { which = AN_wealth_growth value = 1.1 } }
			bricks = { multiply_variable = { which = AN_wealth_growth value = 1.1 } }
			books = { multiply_variable = { which = AN_wealth_growth value = 1.1 } }
			brass = { multiply_variable = { which = AN_wealth_growth value = 1.2 } }
			bronze = { multiply_variable = { which = AN_wealth_growth value = 1.2 } }
			cigars = { multiply_variable = { which = AN_wealth_growth value = 1.3 } }
			confectionary = { multiply_variable = { which = AN_wealth_growth value = 1.3 } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			fertilizer = { multiply_variable = { which = AN_wealth_growth value = 1.1 } multiply_variable = { which = AN_pop_growth value = 1.3 } }
			furniture = { multiply_variable = { which = AN_wealth_growth value = 1.4 } }
			glass = { multiply_variable = { which = AN_wealth_growth value = 1.3 } }
			gunpowder = { multiply_variable = { which = AN_wealth_growth value = 1.1 } }
			metalwork = { multiply_variable = { which = AN_wealth_growth value = 1.2 } }
			jewelry = { multiply_variable = { which = AN_wealth_growth value = 1.5 } }
			#liquor = { multiply_variable = { which = AN_wealth_growth value = 1.3 } }
			naval_supplies = { multiply_variable = { which = AN_wealth_growth value = 1.1 } }
			chinaware = { multiply_variable = { which = AN_wealth_growth value = 1.3 } }
			resin = { multiply_variable = { which = AN_wealth_growth value = 1.4 } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			rubber = { multiply_variable = { which = AN_wealth_growth value = 1.2 } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			rum = { multiply_variable = { which = AN_wealth_growth value = 1.3 } }
			steel = { multiply_variable = { which = AN_wealth_growth value = 1.1 } }
			cloth = { multiply_variable = { which = AN_wealth_growth value = 1.2 } }
			wine = { multiply_variable = { which = AN_wealth_growth value = 1.1 } }
			aluminum = { multiply_variable = { which = AN_wealth_growth value = 1.5 } }
			chemicals = { multiply_variable = { which = AN_wealth_growth value = 1.5 } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			concrete = { multiply_variable = { which = AN_wealth_growth value = 1.5 } }
			explosives = { multiply_variable = { which = AN_wealth_growth value = 1.5 } }
			#machines = { multiply_variable = { which = AN_wealth_growth value = 1.5 } }
			machine_parts = { multiply_variable = { which = AN_wealth_growth value = 1.5 } }
			medicine = { multiply_variable = { which = AN_wealth_growth value = 1.5 } multiply_variable = { which = AN_pop_growth value = 1.1 } }
			#munitions = { multiply_variable = { which = AN_wealth_growth value = 1.5 } }
			perfume = { multiply_variable = { which = AN_wealth_growth value = 1.5 } }
			preserves = { multiply_variable = { which = AN_wealth_growth value = 1.5 } multiply_variable = { which = AN_pop_growth value = 1.2 } }
			#
			chromite = { multiply_variable = { which = AN_wealth_growth value = 1.5 } multiply_variable = { which = AN_pop_growth value = 0.8 } }
			coal = { multiply_variable = { which = AN_wealth_growth value = 1.5 } multiply_variable = { which = AN_pop_growth value = 0.9 } }
			phosphate = { multiply_variable = { which = AN_wealth_growth value = 1.5 } multiply_variable = { which = AN_pop_growth value = 1.3 } }
		}
			
		#Census View
		divide_variable = {
			which = AN_pop_growth
			which = AN_logistics
		}	
		multiply_variable = {
			which = AN_wealth_growth
			which = AN_wealth_production
		}
		divide_variable = { 
			which = AN_civ_stat
			value = 10
		}
		change_variable = { 
			which = AN_civ_stat
			value = 1
		}
		multiply_variable = {
			which = AN_wealth_growth
			which = AN_civ_stat
		}	
		divide_variable = {
			which = AN_wealth_growth
			which = AN_logistics
		}	
		subtract_variable = { 
			which = AN_civ_stat
			value = 1
		}
		if = { 
			limit = { check_variable = { which = AN_pop_growth value = 0 } }
			set_variable = {
				which = AN_migration_growth
				which = AN_pop_growth
			}
			multiply_variable = {
				which = AN_migration_growth
				which = AN_civ_stat
			}
			subtract_variable = {
				which = AN_pop_growth
				which = AN_migration_growth
			}
			
		}
		else = {
			set_variable = { which = AN_migration_growth value = -1 }
		}
		
		multiply_variable = { #RESET Civ 
			which = AN_civ_stat
			value = 100
		}
	}
}


AN_migration_calc = {
	hidden_effect = {
		AN_check_dev_variables = yes
		set_variable = { which = AN_sum_E which = AN_migration_growth }
		set_variable = { which = AN_sum_I which = AN_migration_factor }
		if = { 
			limit = { check_variable = { which = AN_migration_growth value = 0 } }
			if = { limit = { owner = { technology_group = western } } 4400 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = latin_group } } 1779 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = german } } 4403 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = nordic } } 4402 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = eastern } } 4401 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = greek } } 1173 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = russian_group } } 1950 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = balkan } } 2194 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = caucasian } } 2200 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = ottoman } } 1781 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = mashriqi } } 1782 = { change_variable = { which = AN_sum_E which = PREV } } } 			
			else_if = { limit = { owner = { technology_group = maghrebi } } 1807 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = persian } } 1814 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = indian } } 1783 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = chinese } } 1784 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = japanese_group } } 1785 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = indochinese } } 1786 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = malay_group } } 1787 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = nomad_group } } 1788 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = sahelian } } 1793 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = sub_saharan } } 1791 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = ethiopian } } 1794 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = east_african } } 1790 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = nyanza } } 1795 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = central_african } } 4168 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = bantu } } 2251 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = khoisan } } 2334 = { change_variable = { which = AN_sum_E which = PREV } } } 			
			else_if = { limit = { owner = { technology_group = siberian_group } } 1789 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = papuan } } 1796 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = australian } } 1797 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = oceanic } } 1798 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = north_american } } 1799 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = mesoamerican } } 1801 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = south_american } } 1802 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = andean } } 1803 = { change_variable = { which = AN_sum_E which = PREV } } } 
			else_if = { limit = { owner = { technology_group = high_american } } 1804 = { change_variable = { which = AN_sum_E which = PREV } } } 
		}
		if = { 
			limit = { check_variable = { which = AN_migration_factor value = 0 } }
			if = { limit = { owner = { technology_group = western } } 4400 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = latin_group } } 1779 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = german } } 4403 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = nordic } } 4402 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = eastern } } 4401 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = greek } } 1173 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = russian_group } } 1950 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = balkan } } 2194 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = caucasian } } 2200 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = ottoman } } 1781 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = mashriqi } } 1782 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = maghrebi } } 1807 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = persian } } 1814 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = indian } } 1783 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = chinese } } 1784 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = japanese_group } } 1785 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = indochinese } } 1786 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = malay_group } } 1787 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = nomad_group } } 1788 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = sahelian } } 1793 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = sub_saharan } } 1791 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = ethiopian } } 1794 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = east_african } } 1790 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = nyanza } } 1795 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = central_african } } 4168 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = bantu } } 2251 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = khoisan } } 2334 = { change_variable = { which = AN_sum_I which = PREV } } } 					
			else_if = { limit = { owner = { technology_group = siberian_group } } 1789 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = papuan } } 1796 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = australian } } 1797 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = oceanic } } 1798 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = north_american } } 1799 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = mesoamerican } } 1801 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = south_american } } 1802 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = andean } } 1803 = { change_variable = { which = AN_sum_I which = PREV } } } 
			else_if = { limit = { owner = { technology_group = high_american } } 1804 = { change_variable = { which = AN_sum_I which = PREV } } } 
		}
	}	
}


AN_dev_calc = {
	hidden_effect = {
		set_variable = { which = AN_migration_progress value = 0 }
		if = {
			limit = { check_variable = { which = AN_migration_factor value = 0 } }
			if = { limit = { owner = { technology_group = western } } 4400 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = latin_group } } 1779 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = german } } 4403 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = nordic } } 4402 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = eastern } } 4401 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = greek } } 1173 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = russian_group } } 1950 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = balkan } } 2194 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = caucasian } } 2200 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = ottoman } }  1781 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = mashriqi } } 1782 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }			
			else_if = { limit = { owner = { technology_group = maghrebi } } 1807 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = persian } } 1814 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = indian } } 1783 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = chinese } } 1784 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = japanese_group } } 1785 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = indochinese } } 1786 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = malay_group } } 1787 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = nomad_group } } 1788 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = sahelian } } 1793 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = sub_saharan } } 1791 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = ethiopian } } 1794 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = east_african } } 1790 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = nyanza } } 1795 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = central_african } } 4168 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }				
			else_if = { limit = { owner = { technology_group = bantu } } 2251 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = khoisan } } 2334 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = siberian_group } } 1789 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = papuan } } 1796 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = australian } } 1797 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = oceanic } } 1798 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = north_american } } 1799 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = mesoamerican } } 1801 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = south_american } } 1802 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = andean } } 1803 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			else_if = { limit = { owner = { technology_group = high_american } } 1804 = { PREV = { set_variable = { which = AN_sum_I which = PREV } set_variable = { which = AN_sum_E which = PREV } } } }
			
			set_variable = { which = AN_migration_progress which = AN_migration_factor } 
			divide_variable = { which = AN_migration_progress which = AN_sum_I }
			multiply_variable = { which = AN_migration_progress which = AN_sum_E }

			change_variable = {
				which = AN_pop_progress
				which = AN_migration_progress
			}
		}
		change_variable = {
			which = AN_pop_progress
			which = AN_pop_growth
		}
		
		change_variable = {
			which = AN_wealth_progress
			which = AN_wealth_growth
		}
		
		#WEALTH CALC
		if = {
			limit = { 
				check_variable = { which = AN_wealth_progress value = 100 }
			}
			add_base_tax = 1
			subtract_variable = {
				which = AN_wealth_progress
				value = 100
			}
			if = {
				limit = { 
					owner = { ai = yes } 
					NOT = {
						check_variable = {
							which = AN_prov_infrastructure
							which = AN_prov_infrastructure_cap
						}
						check_variable = {
							which = AN_prov_infrastructure 
							which = AN_prov_wealth
						}
					}
				}
				add_base_tax = -2
				add_base_production = 1
			}
		}
		#POP CALC
		if = {
			limit = { 
				check_variable = { which = AN_pop_progress value = 100 }
			}
			subtract_variable = {
				which = AN_pop_progress
				value = 100
			}
			add_base_manpower = 1
		}
		else_if = { # lose pop
			limit = { NOT = { check_variable = { which = AN_pop_progress value = 0 } } }
			if = {
				limit = { base_manpower = 2 }
				add_base_manpower = -1
			}
			set_variable = {
				which = AN_pop_progress
				value = 10
			}
		}
		
		# CULTURE RESETTLEMENT
		if = {
			limit = {
				OR = {
					AND = { 
						has_building = village
						base_manpower = 6
					}
					AND = { 
						has_building = town
						base_manpower = 11
					}
					AND = {
						has_building = city
						base_manpower = 25
					}
					AND = {
						has_building = metropolis
						base_manpower = 50
					}
					AND = {
						NOT = { OR = { has_building = village has_building = town has_building = city has_building = metropolis } }
						base_manpower = 2
					}
				}
				NOT = { OR = { has_province_modifier = AN_sent_migrants has_province_modifier = AN_received_migrants } }
				#NOT = { check_variable = { which = AN_migration_factor = 0 } } #Needs replacing
			}
			
			#SELECT MAJ/MIN ORIGIN
			if = { 
				limit = { check_variable = { which = AN_minority_culture_size value = 3 } }
				random_list = {
					4 = {
						modifier = {
							factor = 2
							has_province_modifier = AN_primary_majority_culture_1
						}
						modifier = {
							factor = 1.75
							has_province_modifier = AN_accepted_majority_culture_1
						}
						modifier = {
							factor = 1.5
							has_province_modifier = AN_coexisting_majority_culture_1
						}
						modifier = {
							factor = 1.25
							has_province_modifier = AN_protected_majority_culture_1
						}
						event_target:AN_DUMMY_PROV = {
							set_variable = { which = AN_province_culture which = PREV }
							set_variable = { which = AN_minority_culture which = AN_province_culture }
						}

						if = {
							limit = {
								AN_linked_culture_religion_maj = yes
							}
							event_target:AN_DUMMY_PROV = {
								set_variable = { which = AN_province_religion which = PREV }
								set_variable = { which = AN_minority_religion which = AN_province_religion }
							}
						}
					}
					3 = {
						modifier = {
							factor = 2
							has_province_modifier = AN_primary_minority_culture_3
						}
						modifier = {
							factor = 1.75
							has_province_modifier = AN_accepted_minority_culture_3
						}
						modifier = {
							factor = 1.5
							has_province_modifier = AN_coexisting_minority_culture_3
						}
						modifier = {
							factor = 1.25
							has_province_modifier = AN_protected_minority_culture_3
						}
						event_target:AN_DUMMY_PROV = {
							set_variable = { which = AN_minority_culture which = PREV }
							set_variable = { which = AN_province_culture which = AN_minority_culture }
						}
						
						if = {
							limit = {
								AN_linked_culture_religion_min_maj = yes
							}
							event_target:AN_DUMMY_PROV = {
								set_variable = { which = AN_province_religion which = PREV }
								set_variable = { which = AN_minority_religion which = AN_province_religion }
							}
						}

						else_if = {
							limit = {
								AN_linked_culture_religion_min = yes
							}
							event_target:AN_DUMMY_PROV = {
								set_variable = { which = AN_minority_religion which = PREV }
								set_variable = { which = AN_province_religion which = AN_minority_religion }
							}
						}
					}
				}
			}
			else_if = { 
				limit = { check_variable = { which = AN_minority_culture_size value = 2 } }
				random_list = {
					5 = {
						modifier = {
							factor = 2
							has_province_modifier = AN_primary_majority_culture_2
						}
						modifier = {
							factor = 1.75
							has_province_modifier = AN_accepted_majority_culture_2
						}
						modifier = {
							factor = 1.5
							has_province_modifier = AN_coexisting_majority_culture_2
						}
						modifier = {
							factor = 1.25
							has_province_modifier = AN_protected_majority_culture_2
						}
						event_target:AN_DUMMY_PROV = {
							set_variable = { which = AN_province_culture which = PREV }
							set_variable = { which = AN_minority_culture which = AN_province_culture }
						}

						if = {
							limit = {
								AN_linked_culture_religion_maj = yes
							}
							event_target:AN_DUMMY_PROV = {
								set_variable = { which = AN_province_religion which = PREV }
								set_variable = { which = AN_minority_religion which = AN_province_religion }
							}
						}
					}
					2 = {
						modifier = {
							factor = 2
							has_province_modifier = AN_primary_minority_culture_2
						}
						modifier = {
							factor = 1.75
							has_province_modifier = AN_accepted_minority_culture_2
						}
						modifier = {
							factor = 1.5
							has_province_modifier = AN_coexisting_minority_culture_2
						}
						modifier = {
							factor = 1.25
							has_province_modifier = AN_protected_minority_culture_2
						}
						event_target:AN_DUMMY_PROV = {
							set_variable = { which = AN_minority_culture which = PREV }
							set_variable = { which = AN_province_culture which = AN_minority_culture }
						}
						
						if = {
							limit = {
								AN_linked_culture_religion_min_maj = yes
							}
							event_target:AN_DUMMY_PROV = {
								set_variable = { which = AN_province_religion which = PREV }
								set_variable = { which = AN_minority_religion which = AN_province_religion }
							}
						}

						else_if = {
							limit = {
								AN_linked_culture_religion_min = yes
							}
							event_target:AN_DUMMY_PROV = {
								set_variable = { which = AN_minority_religion which = PREV }
								set_variable = { which = AN_province_religion which = AN_minority_religion }
							}
						}
					}
				}
			}
			else_if = { 
				limit = { check_variable = { which = AN_minority_culture_size value = 1 } }
				random_list = {
					6 = {
						modifier = {
							factor = 2
							has_province_modifier = AN_primary_majority_culture_3
						}
						modifier = {
							factor = 1.75
							has_province_modifier = AN_accepted_majority_culture_3
						}
						modifier = {
							factor = 1.5
							has_province_modifier = AN_coexisting_majority_culture_3
						}
						modifier = {
							factor = 1.25
							has_province_modifier = AN_protected_majority_culture_3
						}
						event_target:AN_DUMMY_PROV = {
							set_variable = { which = AN_province_culture which = PREV }
							set_variable = { which = AN_minority_culture which = AN_province_culture }
						}

						if = {
							limit = {
								AN_linked_culture_religion_maj = yes
							}
							event_target:AN_DUMMY_PROV = {
								set_variable = { which = AN_province_religion which = PREV }
								set_variable = { which = AN_minority_religion which = AN_province_religion }
							}
						}
					}
					1 = {
						modifier = {
							factor = 2
							has_province_modifier = AN_primary_minority_culture_1
						}
						modifier = {
							factor = 1.75
							has_province_modifier = AN_accepted_minority_culture_1
						}
						modifier = {
							factor = 1.5
							has_province_modifier = AN_coexisting_minority_culture_1
						}
						modifier = {
							factor = 1.25
							has_province_modifier = AN_protected_minority_culture_1
						}
						event_target:AN_DUMMY_PROV = {
							set_variable = { which = AN_minority_culture which = PREV }
							set_variable = { which = AN_province_culture which = AN_minority_culture }
						}
						
						if = {
							limit = {
								AN_linked_culture_religion_min_maj = yes
							}
							event_target:AN_DUMMY_PROV = {
								set_variable = { which = AN_province_religion which = PREV }
								set_variable = { which = AN_minority_religion which = AN_province_religion }
							}
						}

						else_if = {
							limit = {
								AN_linked_culture_religion_min = yes
							}
							event_target:AN_DUMMY_PROV = {
								set_variable = { which = AN_minority_religion which = PREV }
								set_variable = { which = AN_province_religion which = AN_minority_religion }
							}
						}
					}
				}
			}
			else = {
				event_target:AN_DUMMY_PROV = {
					set_variable = { which = AN_province_culture which = PREV }
					set_variable = { which = AN_minority_culture which = AN_province_culture }
				}

				if = {
					limit = {
						AN_linked_culture_religion_maj = yes
					}
					event_target:AN_DUMMY_PROV = {
						set_variable = { which = AN_province_religion which = PREV }
						set_variable = { which = AN_minority_religion which = AN_province_religion }
					}
				}
			}
			
			owner = { save_global_event_target_as = AN_resettle_owner }
			
			random_list = { 
				3 = { 	#Neighbor
					trigger = { 
						any_neighbor_province = {
							check_variable = { which = AN_migration_factor value = 0 }
							NOT = { OR = { has_province_modifier = AN_received_migrants has_province_modifier = AN_sent_migrants } }
							OR = { 
								check_variable = { which = AN_prov_pop_cap which = AN_prov_pop }
								has_building = village
								has_building = town
								has_building = city
								has_building = metropolis
							}
						}
					}
					modifier = {
						factor = 1.5
						has_building = village
					}
					modifier = {
						factor = 2
						has_building = town
					}
					modifier = {
						factor = 2.5
						has_building = city
					}
					modifier = {
						factor = 3
						has_building = metropolis
					}
					modifier = {
						factor = 2
						check_variable = { which = AN_prov_pop which = AN_prov_pop_cap }
					}
					
					
					save_global_event_target_as = AN_resettle_origin 
					
					random_neighbor_province = { 
						limit = { 
							check_variable = { which = AN_migration_factor value = 0 }
							NOT = { OR = { has_province_modifier = AN_received_migrants has_province_modifier = AN_sent_migrants } }
							check_variable = { which = AN_prov_pop_cap which = AN_prov_pop }
						}
						save_global_event_target_as = AN_resettle_target
					}
					random_neighbor_province = { 
						limit = { 
							check_variable = { which = AN_migration_factor value = 0 }
							NOT = { OR = { has_province_modifier = AN_received_migrants has_province_modifier = AN_sent_migrants } }
							OR = {
								has_building = village
								has_building = town
								has_building = city
								has_building = metropolis	
							}
						}
						save_global_event_target_as = AN_resettle_target
					}
					random_neighbor_province = { 
						limit = { 
							check_variable = { which = AN_migration_factor value = 0 }
							NOT = { OR = { has_province_modifier = AN_received_migrants has_province_modifier = AN_sent_migrants } }
							check_variable = { which = AN_prov_pop_cap which = AN_prov_pop }
							OR = {
								has_building = village
								has_building = town
								has_building = city
								has_building = metropolis	
							}
						}
						save_global_event_target_as = AN_resettle_target
					}
					
					set_province_flag = AN_migration
				}
				3 = { 	#Owned Port
					trigger = {
						has_port = yes
						owner = {
							any_owned_province = {
								check_variable = { which = AN_migration_factor value = 0 }
								NOT = { OR = { has_province_modifier = AN_received_migrants has_province_modifier = AN_sent_migrants } }
								has_port = yes
								OR = { 
									check_variable = { which = AN_prov_pop_cap which = AN_prov_pop }
									has_building = village
									has_building = town
									has_building = city
									has_building = metropolis
								}
							}
						}
					}
					modifier = {
						factor = 1.5
						has_building = village
					}
					modifier = {
						factor = 2
						has_building = town
					}
					modifier = {
						factor = 2.5
						has_building = city
					}
					modifier = {
						factor = 3
						has_building = metropolis
					}
					modifier = {
						factor = 2
						check_variable = { which = AN_prov_pop which = AN_prov_pop_cap }
					}
					save_global_event_target_as = AN_resettle_origin 
					
					owner = { 
						random_owned_province = {  
							limit = { 
								check_variable = { which = AN_migration_factor value = 0 }
								NOT = { OR = { has_province_modifier = AN_received_migrants has_province_modifier = AN_sent_migrants } }
								has_port = yes
								OR = { 
									check_variable = { which = AN_prov_pop_cap which = AN_prov_pop }
									has_building = village
									has_building = town
									has_building = city
									has_building = metropolis
								}
							}
							save_global_event_target_as = AN_resettle_target
						}
					}
					set_province_flag = AN_migration
				}
				2 = { 	#Colonial
					trigger = {
						is_state = yes
						OR = { 
							has_owner_culture = yes
							has_owner_accepted_culture = yes
						}
						is_overseas = no
						owner = {
							any_owned_province = {
								check_variable = { which = AN_migration_factor value = 0 }
								NOT = { OR = { has_province_modifier = AN_received_migrants has_province_modifier = AN_sent_migrants } }
								is_state = no
								OR = { 
									check_variable = { which = AN_prov_pop_cap which = AN_prov_pop }
									has_building = village
									has_building = town
									has_building = city
									has_building = metropolis
								}
							}
						}
					}
					modifier = {
						factor = 1.5
						has_building = village
					}
					modifier = {
						factor = 2
						has_building = town
					}
					modifier = {
						factor = 2.5
						has_building = city
					}
					modifier = {
						factor = 3
						has_building = metropolis
					}
					modifier = {
						factor = 2
						check_variable = { which = AN_prov_pop which = AN_prov_pop_cap }
					}
					save_global_event_target_as = AN_resettle_origin 
					
					owner = { 
						random_owned_province = { 
							limit = {
								check_variable = { which = AN_migration_factor value = 0 }
								NOT = { OR = { has_province_modifier = AN_received_migrants has_province_modifier = AN_sent_migrants } }
								is_state = no
								OR = { 
									check_variable = { which = AN_prov_pop_cap which = AN_prov_pop }
									has_building = village
									has_building = town
									has_building = city
									has_building = metropolis
								}
							}
							save_global_event_target_as = AN_resettle_target
						}
					}
					set_province_flag = AN_migration
				} 
				2 = { 	#International
					trigger = {
						OR = { 
							has_building = village
							has_building = town
							has_building = city
							has_building = metropolis
						}
						any_known_country = {
							OR = {
								#alliance_with = event_target:AN_settle_owner
								gives_military_access_to = event_target:AN_resettle_owner
								gives_fleet_basing_rights_to = event_target:AN_resettle_owner
								technology_group = event_target:AN_settle_owner
							}
							any_owned_province = {
								check_variable = { which = AN_migration_factor value = 0 }
								NOT = { OR = { has_province_modifier = AN_received_migrants has_province_modifier = AN_sent_migrants } }
								OR = { 
									check_variable = { which = AN_prov_pop_cap which = AN_prov_pop }
									has_building = village
									has_building = town
									has_building = city
									has_building = metropolis
								}
							}
						}
					}
					modifier = {
						factor = 1.5
						has_building = village
					}
					modifier = {
						factor = 2
						has_building = town
					}
					modifier = {
						factor = 2.5
						has_building = city
					}
					modifier = {
						factor = 3
						has_building = metropolis
					}
					modifier = {
						factor = 2
						check_variable = { which = AN_prov_pop which = AN_prov_pop_cap }
					}
					save_global_event_target_as = AN_resettle_origin 
					
					random_known_country = { 
						OR = {
							#alliance_with = event_target:AN_settle_owner
							gives_military_access_to = event_target:AN_resettle_owner
							gives_fleet_basing_rights_to = event_target:AN_resettle_owner
							technology_group = event_target:AN_settle_owner
						}
						random_owned_province = { 
							limit = {
								check_variable = { which = AN_migration_factor value = 0 }
								NOT = { OR = { has_province_modifier = AN_received_migrants has_province_modifier = AN_sent_migrants } }
								OR = { 
									check_variable = { which = AN_prov_pop_cap which = AN_prov_pop }
									has_building = village
									has_building = town
									has_building = city
									has_building = metropolis
								}
							}
							save_global_event_target_as = AN_resettle_target
						}
					}
					set_province_flag = AN_migration
				} 
				390 = { #Do Nothing
				
				} 
			}
			
			if = { 
				limit = { has_province_flag = AN_migration }
				
				trigger_switch = {
					on_trigger = base_manpower
					70 = { add_base_manpower = -10 add_base_tax = -10 event_target:AN_resettle_target = { add_base_manpower = 10 add_base_tax = 10 } }
					63 = { add_base_manpower = -9 add_base_tax = -9 event_target:AN_resettle_target = { add_base_manpower = 9 add_base_tax = 9 } }
					56 = { add_base_manpower = -8 add_base_tax = -8 event_target:AN_resettle_target = { add_base_manpower = 8 add_base_tax = 8 } }
					49 = { add_base_manpower = -7 add_base_tax = -7 event_target:AN_resettle_target = { add_base_manpower = 7 add_base_tax = 7 } }
					42 = { add_base_manpower = -6 add_base_tax = -6 event_target:AN_resettle_target = { add_base_manpower = 6 add_base_tax = 6 } }
					35 = { add_base_manpower = -5 add_base_tax = -5 event_target:AN_resettle_target = { add_base_manpower = 5 add_base_tax = 5 } }
					28 = { add_base_manpower = -4 add_base_tax = -4 event_target:AN_resettle_target = { add_base_manpower = 4 add_base_tax = 4 } }
					21 = { add_base_manpower = -3 add_base_tax = -3 event_target:AN_resettle_target = { add_base_manpower = 3 add_base_tax = 3 } }
					14 = { add_base_manpower = -2 add_base_tax = -2 event_target:AN_resettle_target = { add_base_manpower = 2 add_base_tax = 2 } }
					2 = { add_base_manpower = -1 add_base_tax = -1 event_target:AN_resettle_target = { add_base_manpower = 1 add_base_tax = 1 } }
				}
			
				event_target:AN_resettle_target = { 
					if = {
						limit = { 
							check_variable = { which = AN_minority_culture_size value = 1 } 
						}
						if = {
							limit = { is_variable_equal = { which = AN_minority_culture which = event_target:AN_DUMMY_PROV } } 
							change_variable = { which = AN_minority_culture_size value = 1 } 
							if = {
								limit = { check_variable = { which = AN_minority_culture_size value = 4 } } 
								change_culture = variable:PREV:AN_minority_culture
								set_variable = {
									which = AN_minority_culture
									which = AN_province_culture
								}
								set_variable = { which = AN_minority_culture_size value = 3 }
							}
						}
						else_if = {
							limit = { is_variable_equal = { which = AN_province_culture which = event_target:AN_DUMMY_PROV } }
							subtract_variable = { which = AN_minority_culture_size value = 1 } 
						}
						else = {
							if = { 
								limit = { NOT = { check_variable = { which = AN_minority_culture_size value = 2 } } }
								set_variable = { which = AN_minority_culture which = event_target:AN_DUMMY_PROV }
								set_variable = { which = AN_minority_culture_size value = 1 }
							}
							else = {
								subtract_variable = { which = AN_minority_culture_size value = 1 } 
							}
						}
						AN_check_culture_minorities = yes 
					}
					else_if = {
						limit = { NOT = { is_variable_equal = { which = AN_province_culture which = event_target:AN_DUMMY_PROV } } } 
						set_variable = { which = AN_minority_culture which = event_target:AN_DUMMY_PROV }
						set_variable = { which = AN_minority_culture_size value = 1 }
			
						AN_check_culture_minorities = yes
					}
					###
					if = {
						limit = { 
							check_variable = { which = AN_minority_religion_size value = 1 } 
						}
						if = {
							limit = { is_variable_equal = { which = AN_minority_religion which = event_target:AN_DUMMY_PROV } } 
							change_variable = { which = AN_minority_religion_size value = 1 } 
							if = {
								limit = { check_variable = { which = AN_minority_religion_size value = 4 } } 
							
								change_religion = variable:PREV:AN_minority_religion
								hidden_effect = {
									set_variable = {
										which = AN_minority_religion
										which = AN_province_religion
									}
									set_variable = { which = AN_minority_religion_size value = 3 }
								}
							}
						}
						else_if = {
							limit = { is_variable_equal = { which = AN_province_religion which = event_target:AN_DUMMY_PROV } } 
							subtract_variable = { which = AN_minority_religion_size value = 1 }
						}
						else = {
							if = { 
								limit = { NOT = { check_variable = { which = AN_minority_religion_size value = 2 } } }
								set_variable = { which = AN_minority_religion which = event_target:AN_DUMMY_PROV }
								set_variable = { which = AN_minority_religion_size value = 1 }
							}
							else = {
								subtract_variable = { which = AN_minority_religion_size value = 1 } 
							}
						}
						AN_check_religion_minorities = yes 
					}
					else_if = {
						limit = { NOT = { is_variable_equal = { which = AN_province_religion which = event_target:AN_DUMMY_PROV } } } 
					
						set_variable = { which = AN_minority_religion which = event_target:AN_DUMMY_PROV }
						set_variable = { which = AN_minority_religion_size value = 1 }
			
						AN_check_religion_minorities = yes
					
					}
				
					add_permanent_province_modifier = {
						name = AN_received_migrants
						duration = 1825
						#hidden = yes
					}
				}
				add_permanent_province_modifier = {
					name = AN_sent_migrants
					duration = 730
					#hidden = yes
				}	
				
				remove_province_flag = AN_migration
			}
			#RESET
			
			clear_global_event_target = AN_resettle_origin
			clear_global_event_target = AN_resettle_target
			clear_global_event_target = AN_resettle_owner
			
			event_target:AN_DUMMY_PROV = {
				set_variable = { which = AN_province_culture value = 0 }
				set_variable = { which = AN_minority_culture value = 0 }
				set_variable = { which = AN_province_religion value = 0 }
				set_variable = { which = AN_minority_religion value = 0 }
			}
		}
	}
}

AN_check_minorities = {
	AN_check_culture_minorities = yes
	AN_check_religion_minorities = yes
}